{% extends "base.html" %}

{% block content %}
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="text-light">All Tasks</h1>
    <a href="{% url 'task-create' %}" class="btn btn-success btn-lg">New Task</a>
  </div>

  <div class="card bg-dark text-light mb-4 p-3">
    <form method="get">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">{{ filter.form.q.label }}</label>
          {{ filter.form.q }}
        </div>
        <div class="col-md-2">
          <label class="form-label">{{ filter.form.active_filter.label }}</label>
          {{ filter.form.active_filter }}
        </div>
        <div class="col-md-2">
          <label class="form-label">{{ filter.form.task_type.label }}</label>
          {{ filter.form.task_type }}
        </div>
        <div class="col-md-2">
          <label class="form-label">{{ filter.form.assignee.label }}</label>
          {{ filter.form.assignee }}
        </div>
        <div class="col-md-1">
          <label class="form-label">{{ filter.form.priority.label }}</label>
          {{ filter.form.priority }}
        </div>
        <div class="col-md-1">
          <label class="form-label">{{ filter.form.status.label }}</label>
          {{ filter.form.status }}
        </div>
      </div>
      <div class="row g-2 mt-3">
        <div class="col-md-2">
          <label class="form-label">{{ filter.form.deadline_filter.label }}</label>
          {{ filter.form.deadline_filter }}
        </div>
        <div class="col-md-10 d-flex align-items-end gap-2">
          <button type="submit" class="btn btn-primary">Filter</button>
          <a href="{% url 'tasks-list' %}" class="btn btn-secondary">Reset Filters</a>
        </div>
      </div>
    </form>
  </div>

  {% if tasks %}
    <div class="table-responsive">
      <table class="table table-dark table-hover align-middle">
        <thead class="table-light text-dark">
          <tr>
            <th>ID</th>
            <th>Task Name</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Assignees</th>
            <th>Task Type</th>
            <th>Deadline</th>
            <th>Updated At</th>
            <th>Created At</th>
            <th>Update</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for task in tasks %}
          <tr>
            <td><a href="{{ task.get_absolute_url }}" class="text-light">{{ task.id }}</a></td>
            <td><a href="{{ task.get_absolute_url }}" class="text-light">{{ task.name }}</a></td>
            <td>{{ task.get_priority_display }}</td>
            <td>{{ task.get_status_display }}</td>
            <td>
              {% for user in task.assignee.all %}
                <span class="badge bg-secondary me-1">{{ user }}</span>
              {% empty %}
                <span>â€”</span>
              {% endfor %}
            </td>
            <td>{{ task.task_type }}</td>
            <td>{{ task.deadline|date:"d.m.Y H:i" }}</td>
            <td>{{ task.updated_at|date:"d.m.Y H:i" }}</td>
            <td>{{ task.created_at|date:"d.m.Y H:i" }}</td>
            <td><a href="{% url 'task-update' pk=task.id %}" class="btn btn-sm btn-outline-primary">Update</a></td>
            <td><a href="{% url 'task-delete' pk=task.id %}?next={% url 'tasks-list' %}" class="btn btn-sm btn-outline-danger">Delete</a></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-light">No tasks available.</p>
  {% endif %}
</div>
{% endblock %}
